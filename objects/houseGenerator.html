<!DOCTYPE html>
<html lang="en">

<head>
	<title>House Generator</title>
	<meta charset="utf-8">

	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

	<link rel="shortcut icon" href="icons/favicon.ico" type="image/x-icon">
	<link rel="icon" href="icons/favicon.ico" type="image/x-icon">

	<meta name="description" content="COVID-19 Simulator - House Generator">
	<meta name="keywords" content="COVID-19, Coronavirus, SARS-CoV-2, Coronavirus disease 2019, Simulator">
	<meta name="author" content="Pavel Boytchev">
	<meta name="version" content="1.0">
	<meta name="date" content="2021.11.24">
	
	<style>
		canvas {border: solid 1px black; margin: 0.5em 1em;}
	</style>
</head>

<body>
	This generator tries to pregenerate all types of two-wing houses.
	<div id="table"></div>
	
	<script>
		var countAll = 0,
			countFailed = 0;
			
		var houses = [];
		
		function wingDoors(px,pz,sx,sz)
		{
			switch( 10*sx+sz )
			{
				case 44:
					return [
						[px+1,pz+2,0]
					];
				case 48:
					return [
						[px+1,pz+4,0],
						[px+2,pz-3,1],
						[px-2,pz+3,3]
					];
				case 84:
					return [
						[px+1,pz+2,0],
						[px-3,pz-2,2]
					];
				case 88:
					return [
						[px+1,pz+4,0],
						[px+4,pz-3,1],
						[px-4,pz+3,3],
						[px-3,pz-4,2]
					];
			}
			return 'failed '+(10*sx+sz);
		}
			
		console.log('sizeA sizeB posB\tdoors');
		for( var faces=0; faces<4; faces++ )
		for( var sizeAX=4; sizeAX<=8; sizeAX+=4 )
		for( var sizeAZ=4; sizeAZ<=8; sizeAZ+=4 )
		for( var sizeBX=4; sizeBX<=8; sizeBX+=4 )
		for( var sizeBZ=4; sizeBZ<=8; sizeBZ+=4 )
		for( var posBX=-4; posBX<=4; posBX+=2 )
		for( var posBZ=-4; posBZ<=4; posBZ+=2 )
		{
			
			countAll++;
			//var result = ` ${sizeAX}x${sizeAZ}   ${sizeBX}x${sizeBZ} `;
			//result += `(${posBX},${posBZ})\t`;
			
			var minAX = -sizeAX/2,
				minAZ = -sizeAZ/2,
				maxAX = +sizeAX/2,
				maxAZ = +sizeAZ/2;

			var minBX = posBX-sizeBX/2,
				minBZ = posBZ-sizeBZ/2,
				maxBX = posBX+sizeBX/2,
				maxBZ = posBZ+sizeBZ/2;
			
			if( minAX==minBX || minAZ==minBZ || maxAX==maxBX || maxAZ==maxBZ || minAX==maxBX || minAZ==maxBZ || maxAX==minBX || maxAZ==minBZ )
			{
				countFailed++;
				continue;
			}
			
			var house = {sizeAX:sizeAX, sizeAZ:sizeAZ, sizeBX:sizeBX, sizeBZ:sizeBZ, posBX:posBX, posBZ:posBZ, dX:Math.max(maxAX,maxBX)/2+Math.min(minAX,minBX)/2, dZ:Math.max(maxAZ,maxBZ)/2+Math.min(minAZ,minBZ)/2 };

			var doorsA = wingDoors(0,0,sizeAX,sizeAZ),
				doorsB = wingDoors(posBX,posBZ,sizeBX,sizeBZ);
			//result += `${doorsA.length}+${doorsB.length}`;
			
			var doorsAB = [];
			
			for( var door of doorsA )
				if( door[0]<minBX || door[0]>maxBX || door[1]<minBZ || door[1]>maxBZ )
					doorsAB.push( door );
			for( var door of doorsB )
				if( door[0]<minAX || door[0]>maxAX || door[1]<minAZ || door[1]>maxAZ )
					doorsAB.push( door );
					
			house.doors = doorsAB;
			house.faces = faces;
			
			//result += `->${doorsAB.length}`;
					
			houses.push( house );
			//console.log( result );
		}
		console.log('count all',countAll);
		console.log('count failed',countFailed);
		
		
		// create images
		var html = '';
		for( var i = 0; i<houses.length; i++ )
		{
			if(i && houses[i].faces!=houses[i-1].faces) html+='<hr>';
			var house = houses[i];
			html += '<canvas width="200" height="200" id="canvas'+i+'"></canvas>';
		}
		
		document.getElementById('table').innerHTML = html;
		
		for( var i = 0; i<houses.length; i++ )
		{
			draw(i);
		}


		function draw(idx)
		{
			var house = houses[idx];
			
			var cvs = document.getElementById('canvas'+idx),
				ctx = cvs.getContext("2d");
			
			// write id
			ctx.font = "12px Arial";
			ctx.fillText(idx, 2, 12);

			// canvas center
			var cx = 100, cz = 100, s = 10;
			

			// draw sidewalks
			ctx.fillStyle = 'antiqueWhite';
			ctx.fillRect(cx-s*house.sizeAX/2-house.dX*s-s, cz-s*house.sizeAZ/2-house.dZ*s-s, s*house.sizeAX+2*s, s*house.sizeAZ+2*s);
			ctx.fillRect(cx-s*house.sizeBX/2+s*house.posBX-house.dX*s-s, cz-s*house.sizeBZ/2+s*house.posBZ-house.dZ*s-s, s*house.sizeBX+2*s, s*house.sizeBZ+2*s);


			// draw wings
			ctx.strokeStyle = 'black';
			ctx.lineWidth = 3;
			ctx.beginPath();
				ctx.rect(cx-s*house.sizeAX/2-house.dX*s, cz-s*house.sizeAZ/2-house.dZ*s, s*house.sizeAX, s*house.sizeAZ);
			ctx.stroke();
			ctx.beginPath();
				ctx.rect(cx-s*house.sizeBX/2+s*house.posBX-house.dX*s, cz-s*house.sizeBZ/2+s*house.posBZ-house.dZ*s, s*house.sizeBX, s*house.sizeBZ);
			ctx.stroke();
			ctx.lineWidth = 1;

			ctx.fillStyle = 'white';
			ctx.fillRect(cx-s*house.sizeAX/2-house.dX*s, cz-s*house.sizeAZ/2-house.dZ*s, s*house.sizeAX, s*house.sizeAZ);
			ctx.fillRect(cx-s*house.sizeBX/2+s*house.posBX-house.dX*s, cz-s*house.sizeBZ/2+s*house.posBZ-house.dZ*s, s*house.sizeBX, s*house.sizeBZ);

			// draw grid
			ctx.strokeStyle = 'lightgray';
			ctx.beginPath();
			for( var x=-10; x<10; x++ )
			{
				ctx.moveTo(cx+s*x,0);
				ctx.lineTo(cx+s*x,200);
				ctx.moveTo(0,cz+s*x);
				ctx.lineTo(200,cz+s*x);
			}
			ctx.stroke();
			ctx.strokeStyle = 'dimgray';
			ctx.beginPath();
				ctx.moveTo(cx,0);
				ctx.lineTo(cx,200);
				ctx.moveTo(0,cz);
				ctx.lineTo(200,cz);
			ctx.stroke();

			
			// draw theoretical doors
			/*
			var doors = wingDoors(0,0,house.sizeAX,house.sizeAZ);
			ctx.strokeStyle = 'black';
			for( var i = 0; i<doors.length; i++ )
			{
				ctx.beginPath();
					ctx.rect(cx+s*doors[i][0]-5-house.dX*s, cz+s*doors[i][1]-5-house.dZ*s, 10, 10);
				ctx.stroke();
			}
			doors = wingDoors(house.posBX,house.posBZ,house.sizeBX,house.sizeBZ);
			ctx.strokeStyle = 'red';
			for( var i = 0; i<doors.length; i++ )
			{
				ctx.beginPath();
					ctx.rect(cx+s*doors[i][0]-5-house.dX*s, cz+s*doors[i][1]-5-house.dZ*s, 10, 10);
				ctx.stroke();
			}
			*/
			
			// draw practical doors
			var doors = house.doors;
			/*
			ctx.fillStyle = 'yellow';
			for( var i = 0; i<doors.length; i++ )
			{
				ctx.fillRect(cx+s*doors[i][0]-5-house.dX*s, cz+s*doors[i][1]-5-house.dZ*s, 10, 10);
			}
			*/
			
			// draw road
			//
			//			0
			// faces:  3 1
			//			2
			
			ctx.fillStyle = 'rgba(0,0,0,0.25)';
			var closestDoorIdx = 0;
			switch( house.faces )
			{
				case 0:
					ctx.fillRect(0,0,2*cx,s);
					for( var i = 1; i<doors.length; i++ )
						if( doors[i][1] < doors[closestDoorIdx][1] )
							closestDoorIdx = i;
					break;
				case 1:
					ctx.fillRect(2*cz-s,0,s,2*cz);
					for( var i = 1; i<doors.length; i++ )
						if( doors[i][0] > doors[closestDoorIdx][0] )
							closestDoorIdx = i;
					break;
				case 2:
					ctx.fillRect(0,2*cz-s,2*cx,s);
					for( var i = 1; i<doors.length; i++ )
						if( doors[i][1] > doors[closestDoorIdx][1] )
							closestDoorIdx = i;
					break;
				case 3:
					ctx.fillRect(0,0,s,2*cz);
					for( var i = 1; i<doors.length; i++ )
						if( doors[i][0] < doors[closestDoorIdx][0] )
							closestDoorIdx = i;
					break;
			}

			// draw final door
			var theDoor = doors[closestDoorIdx];
			ctx.fillStyle = 'red';
			ctx.fillRect(cx+s*theDoor[0]-5-house.dX*s, cz+s*theDoor[1]-5-house.dZ*s, 10, 10);
			//ctx.strokeRect(cx+s*theDoor[0]-6-house.dX*s, cz+s*theDoor[1]-6-house.dZ*s, 12, 12);

			// draw outside
			var x = theDoor[0]-house.dX, // position in door
				z = theDoor[1]-house.dZ;
			
			var x1 = x, // position out door
				z1 = z;
			switch( theDoor[2] )
			{
				case 0: z-=0.5; z1+=0.5; break;
				case 1: x-=0.5; x1+=0.5; break;
				case 2: z+=0.5; z1-=0.5; break;
				case 3: x+=0.5; x1-=0.5; break;
			}	

			var x2 = x1, // position out door
				z2 = z1;
			switch( house.faces )
			{
				case 0: z2=-10; break;
				case 1: x2=+10; break;
				case 2: z2=+10; break;
				case 3: x2=-10; break;
			}	

			ctx.strokeStyle = 'cornflowerblue';
			ctx.lineWidth = 3;
			ctx.beginPath();
				ctx.moveTo(cx+s*x,cz+s*z);
				ctx.lineTo(cx+s*x1,cz+s*z1);
				
				if( house.faces==0 && theDoor[2]==0 )
				{
					var span = 0.5+Math.max( house.sizeAX/2, house.posBX+house.sizeBX/2 ) - theDoor[0];
					ctx.lineTo(cx+s*x1+s*span,cz+s*z1);
					x2 += span;
					console.log('prob',idx);
				}
				
				ctx.lineTo(cx+s*x2,cz+s*z2);
			ctx.stroke();
			
		}
	</script>
	
</body>
</html>
